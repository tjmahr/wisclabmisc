<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Utterance length imputation and weighting • wisclabmisc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Utterance length imputation and weighting">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">wisclabmisc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/gamlss-tools.html">Tools for GAMLSS models</a></li>
    <li><a class="dropdown-item" href="../articles/roc.html">Tools for ROC curves</a></li>
    <li><a class="dropdown-item" href="../articles/utterance-length-imputation.html">Utterance length imputation and weighting</a></li>
    <li><a class="dropdown-item" href="../articles/brms.html">A Workflow for brms</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tjmahr/wisclabmisc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Utterance length imputation and weighting</h1>
                        <h4 data-toc-skip class="author">Tristan
Mahr</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tjmahr/wisclabmisc/blob/main/vignettes/articles/utterance-length-imputation.Rmd" class="external-link"><code>vignettes/articles/utterance-length-imputation.Rmd</code></a></small>
      <div class="d-none name"><code>utterance-length-imputation.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tjmahr/wisclabmisc" class="external-link">wisclabmisc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>In this article, I describe the background of the
<code><a href="../reference/impute_values_by_length.html">impute_values_by_length()</a></code> and
<code><a href="../reference/weight_lengths_with_ordinal_model.html">weight_lengths_with_ordinal_model()</a></code> functions in our work
and demonstrate their use. Each of these functions had been used in
different projects (for example, intelligibility and then later
articulation rate), and I had been copying and tweaking the code from
project to project. I have decided to give them a more static, public
implementation in this package. For each function, I will first show the
most recent package implementation and demonstrate the package version,
verifying that produce similar results.</p>
<p>For the demonstrations that follow, I used the
<code>data_example_intelligibility_by_length</code> dataset which
consists of model-simulated intelligibility scores. In short, I fit a
model for children’s intelligibility scores and then asked the most to
estimate back the original data, provide a statistically faithful but
jittered version of the original dataset.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_demo</span> <span class="op">&lt;-</span> <span class="va">data_example_intelligibility_by_length</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">length_longest</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>In Hustad and colleagues (2020), we modeled intelligibility data in
young children’s speech. Children would hear an utterance and then would
repeat it. The utterances started at 2 words in length, then increased
to 3 words in length, and so on in batches of 10 sentences, all the way
to 7 words in length. There was a problem, however: Not all of the
children could produce utterances at every length. Specifically, if a
child could not reliably produced 5 utterances of a given length length,
the task was halted. So given the nature of the task, if a child had
produced 5-word utterances, they also produced 2–4-word utterances as
well.</p>
<p>Here, in our modeled/re-simulated version of the dataset, observe how
the number of children per utterance length decreases:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_demo</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">tocs_level</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 2</span></span></span>
<span><span class="co">#&gt;   tocs_level     n</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>          1   164</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>          2   164</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>          3   162</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>          4   102</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>          5    47</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>          6    30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>          7    24</span></span></code></pre></div>
<p>The length of the utterance plausibly influenced the outcome
variable: Longer utterances have more words that might help a listener
understand the sentence, for example. Therefore, it did not seem
appropriate to ignore the missing values. We used the following two-step
procedure (see the <a href="https://doi.org/10.23641/asha.12330956.v1" class="external-link">Supplemental
Materials</a> for more detail):</p>
<ol style="list-style-type: decimal">
<li><p>impute the missing values at each utterance length using values
from shorter lengths, and do the imputation in stages, so that an
imputed value for length <em>L</em> can be used a predictor for
<em>L</em> + 1.</p></li>
<li><p>weight each utterance length by the probability of it being
produced for a child at a given age and take the weighted average of the
outcome variable across all length.</p></li>
</ol>
<p>Our goal for the data preparation was to produce a single-number
intelligibility score, which this final weighted average provides such a
number. With this procedure, missing data is not ignored and implausible
data (like the longest utterances at the youngest ages) is
downweighted.</p>
</div>
<div class="section level2">
<h2 id="imputation">Imputation<a class="anchor" aria-label="anchor" href="#imputation"></a>
</h2>
<p>The flow for the code consists of the following steps:</p>
<ul>
<li>reshape the data into a wide format,</li>
<li>train a series of linear models trained on the <em>observed</em>
data,</li>
<li>predict the responses for missing values</li>
<li>reshape back to a long format</li>
</ul>
<p>Here is the most recent non-package version of the function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">impute_values</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">var</span>, <span class="va">data_train</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu">build_wider_spec_for_imputation</span><span class="op">(</span><span class="va">data</span>, <span class="op">{</span><span class="op">{</span> <span class="va">var</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">data_wide</span> <span class="op">&lt;-</span> <span class="fu">pivot_wider_for_imputation</span><span class="op">(</span><span class="va">data</span>, <span class="va">spec</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">data_train</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data_train</span> <span class="op">&lt;-</span> <span class="va">data</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">data_wide_train</span> <span class="op">&lt;-</span> <span class="fu">pivot_wider_for_imputation</span><span class="op">(</span><span class="va">data_train</span>, <span class="va">spec</span><span class="op">)</span></span>
<span>  <span class="va">models</span> <span class="op">&lt;-</span> <span class="fu">fit_imputation_models</span><span class="op">(</span><span class="va">data_wide_train</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">data_imputed</span> <span class="op">&lt;-</span> <span class="va">data_wide</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      y_3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y_3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">models</span><span class="op">$</span><span class="va">m_3</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">y_3</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      y_4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y_4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">models</span><span class="op">$</span><span class="va">m_4</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">y_4</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      y_5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y_5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">models</span><span class="op">$</span><span class="va">m_5</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">y_5</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      y_6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y_6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">models</span><span class="op">$</span><span class="va">m_6</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">y_6</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      y_7 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y_7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">models</span><span class="op">$</span><span class="va">m_7</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">y_7</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># handle these separately because `length_longest` could have been imputed if</span></span>
<span>  <span class="co"># there was a different strategy</span></span>
<span>  <span class="va">data_child_ll</span> <span class="op">&lt;-</span> <span class="va">data_wide</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">subject_num</span>, <span class="va">visit_id</span>, <span class="va">age_months</span>, <span class="va">length_longest</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">data_original_values</span> <span class="op">&lt;-</span> <span class="va">data_wide</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer_spec.html" class="external-link">pivot_longer_spec</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">subject_num</span>, <span class="va">visit_id</span>, <span class="va">tocs_level</span>, <span class="op">{</span><span class="op">{</span> <span class="va">var</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="va">data_imputed</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer_spec.html" class="external-link">pivot_longer_spec</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"imputed_{{ var }}"</span> <span class="op">:=</span> <span class="op">{</span><span class="op">{</span> <span class="va">var</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">length_longest</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>      <span class="va">data_child_ll</span>,</span>
<span>      by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span>, <span class="st">"subject_num"</span>, <span class="st">"visit_id"</span>, <span class="st">"age_months"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>      <span class="va">data_original_values</span>,</span>
<span>      by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span>, <span class="st">"subject_num"</span>, <span class="st">"visit_id"</span>, <span class="st">"tocs_level"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      imputed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span> <span class="va">var</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span>, <span class="st">"imputed"</span>, <span class="st">"observed"</span><span class="op">)</span>,</span>
<span>      facet_lab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">tocs_level</span>, <span class="st">" words"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="va">d</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fit_imputation_models</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    m_7 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y_7</span> <span class="op">~</span> <span class="va">y_1</span> <span class="op">+</span> <span class="va">y_2</span> <span class="op">+</span> <span class="va">y_3</span> <span class="op">+</span> <span class="va">y_4</span> <span class="op">+</span> <span class="va">y_5</span> <span class="op">+</span> <span class="va">y_6</span>, <span class="va">data</span><span class="op">)</span>,</span>
<span>    m_6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y_6</span> <span class="op">~</span> <span class="va">y_1</span> <span class="op">+</span> <span class="va">y_2</span> <span class="op">+</span> <span class="va">y_3</span> <span class="op">+</span> <span class="va">y_4</span> <span class="op">+</span> <span class="va">y_5</span> <span class="op">+</span> <span class="va">length_longest</span>, <span class="va">data</span><span class="op">)</span>,</span>
<span>    m_5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y_5</span> <span class="op">~</span> <span class="va">y_1</span> <span class="op">+</span> <span class="va">y_2</span> <span class="op">+</span> <span class="va">y_3</span> <span class="op">+</span> <span class="va">y_4</span> <span class="op">+</span> <span class="va">length_longest</span>, <span class="va">data</span><span class="op">)</span>,</span>
<span>    m_4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y_4</span> <span class="op">~</span> <span class="va">y_1</span> <span class="op">+</span> <span class="va">y_2</span> <span class="op">+</span> <span class="va">y_3</span> <span class="op">+</span> <span class="va">length_longest</span>, <span class="va">data</span><span class="op">)</span>,</span>
<span>    m_3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y_3</span> <span class="op">~</span> <span class="va">y_1</span> <span class="op">+</span> <span class="va">y_2</span> <span class="op">+</span> <span class="va">length_longest</span>, <span class="va">data</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">build_wider_spec_for_imputation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">var</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider_spec.html" class="external-link">build_wider_spec</a></span><span class="op">(</span></span>
<span>    <span class="va">data</span>,</span>
<span>    names_from <span class="op">=</span> <span class="va">tocs_level</span>,</span>
<span>    names_prefix <span class="op">=</span> <span class="st">"y_"</span>,</span>
<span>    values_from <span class="op">=</span> <span class="op">{</span><span class="op">{</span> <span class="va">var</span> <span class="op">}</span><span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">pivot_wider_for_imputation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">spec</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider_spec.html" class="external-link">pivot_wider_spec</a></span><span class="op">(</span></span>
<span>      <span class="va">spec</span>,</span>
<span>      id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="va">group</span>, <span class="va">subject_num</span>, <span class="va">visit_id</span>, <span class="va">length_longest</span>, <span class="va">age_months</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This implementation is unsatisfactory for a number of reasons. It
hardcodes many unneeded variables, so to apply it to the example
dataset, I have to add filler values for those variables. It also
hardcodes the number of models and the predictors for the imputation
model. The <code>y_1</code> in the <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> indicates that the
scores from the single-word trials are being used for the imputation.
This inclusion may or may not be appropriate. In speaking rate studies,
it doesn’t make sense to use include data from the single-word
trials.</p>
<p>But, these caveats aside, it works:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_imputation_1</span> <span class="op">&lt;-</span> <span class="va">data_demo</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"fake"</span>, visit_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>subject_num <span class="op">=</span> <span class="va">child</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">impute_values</span><span class="op">(</span><span class="va">sim_intelligibility</span><span class="op">)</span></span></code></pre></div>
<p>And here is how we can recreate Figure 3 from the supplemental
materials:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotting_constants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    imputed <span class="op">=</span> <span class="st">"#C7A76C"</span>, </span>
<span>    observed <span class="op">=</span> <span class="st">"#7DB0DD"</span>, </span>
<span>    <span class="st">"mean ± SE"</span> <span class="op">=</span> <span class="st">"grey30"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  guides_pal <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span></span>
<span>    shape <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">17</span>, <span class="fl">16</span><span class="op">)</span>,</span>
<span>        linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blank"</span>, <span class="st">"blank"</span>, <span class="st">"solid"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="va">plotting_constants</span><span class="op">$</span><span class="va">scale_pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>  values <span class="op">=</span> <span class="va">plotting_constants</span><span class="op">$</span><span class="va">pal</span>, </span>
<span>  limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">plotting_constants</span><span class="op">$</span><span class="va">pal</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_imputation_1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tocs_level</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">length_longest</span>, </span>
<span>    y <span class="op">=</span> <span class="va">imputed_sim_intelligibility</span>, </span>
<span>    color <span class="op">=</span> <span class="va">imputed</span>, </span>
<span>    shape <span class="op">=</span> <span class="va">imputed</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.3</span>, alpha <span class="op">=</span> <span class="fl">.5</span>, height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">length_longest</span>, color <span class="op">=</span> <span class="st">"mean ± SE"</span><span class="op">)</span>, </span>
<span>    fun.data <span class="op">=</span> <span class="va">mean_se</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">plotting_constants</span><span class="op">$</span><span class="va">scale_pal</span> <span class="op">+</span> </span>
<span>  <span class="va">plotting_constants</span><span class="op">$</span><span class="va">guides_pal</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="st">"facet_lab"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    <span class="st">"Intelligibility"</span>, </span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent_format</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Length of longest utterance (observed)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.justification <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="utterance-length-imputation_files/figure-html/unnamed-chunk-7-1.png" alt="Results of imputing multiword intelligibility using length-of-longest utterance and the average
intelligibilities of shorter utterance lengths." width="900"><p class="caption">
Results of imputing multiword intelligibility using length-of-longest
utterance and the average intelligibilities of shorter utterance
lengths.
</p>
</div>
<p>In comparison, here is the package version of this procedure. We have
to specify all of the relevant variables ahead of time, but the number
of models or the variables involved are no longer hard-coded.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_imputation_2</span> <span class="op">&lt;-</span> <span class="va">data_demo</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/impute_values_by_length.html">impute_values_by_length</a></span><span class="op">(</span></span>
<span>    var_y <span class="op">=</span> <span class="va">sim_intelligibility</span>,</span>
<span>    var_length <span class="op">=</span> <span class="va">tocs_level</span>,</span>
<span>    id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">child</span>, <span class="va">age_months</span>, <span class="va">length_longest</span><span class="op">)</span>, </span>
<span>    include_max_length <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">data_imputation_1</span><span class="op">$</span><span class="va">imputed_sim_intelligibility</span>, </span>
<span>  <span class="va">data_imputation_2</span><span class="op">$</span><span class="va">sim_intelligibility_imputed</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>In the original models, the length of the longest utterance is used
as a continuous predictor in the imputations. In the package version
this behavior is optional and disabled by default. It does not affect
the results noticeably.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_imputation_3</span> <span class="op">&lt;-</span> <span class="va">data_demo</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/impute_values_by_length.html">impute_values_by_length</a></span><span class="op">(</span></span>
<span>    var_y <span class="op">=</span> <span class="va">sim_intelligibility</span>,</span>
<span>    var_length <span class="op">=</span> <span class="va">tocs_level</span>,</span>
<span>    id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">child</span>, <span class="va">age_months</span>, <span class="va">length_longest</span><span class="op">)</span>, </span>
<span>    include_max_length <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">data_imputation_2</span><span class="op">$</span><span class="va">sim_intelligibility_imputed</span>, </span>
<span>  <span class="va">data_imputation_3</span><span class="op">$</span><span class="va">sim_intelligibility_imputed</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Mean relative difference: 8.473438e-05"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span></span>
<span>  <span class="va">data_imputation_2</span><span class="op">$</span><span class="va">sim_intelligibility_imputed</span>, </span>
<span>  <span class="va">data_imputation_3</span><span class="op">$</span><span class="va">sim_intelligibility_imputed</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_imputation_2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tocs_level</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">length_longest</span>, </span>
<span>    y <span class="op">=</span> <span class="va">sim_intelligibility_imputed</span>, </span>
<span>    color <span class="op">=</span> <span class="va">sim_intelligibility_imputation</span>, </span>
<span>    shape <span class="op">=</span> <span class="va">sim_intelligibility_imputation</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.3</span>, alpha <span class="op">=</span> <span class="fl">.5</span>, height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">length_longest</span>, color <span class="op">=</span> <span class="st">"mean ± SE"</span><span class="op">)</span>, </span>
<span>    fun.data <span class="op">=</span> <span class="va">mean_se</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">plotting_constants</span><span class="op">$</span><span class="va">scale_pal</span> <span class="op">+</span> </span>
<span>  <span class="va">plotting_constants</span><span class="op">$</span><span class="va">guides_pal</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="st">"tocs_level"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    <span class="st">"Intelligibility"</span>, </span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent_format</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Length of longest utterance (observed)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.justification <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="utterance-length-imputation_files/figure-html/unnamed-chunk-9-1.png" width="900"></p>
<div class="section level3">
<h3 id="limit-the-observations-used-to-train-the-imputation-model">Limit the observations used to train the imputation model<a class="anchor" aria-label="anchor" href="#limit-the-observations-used-to-train-the-imputation-model"></a>
</h3>
<p>The <code>data_train</code> argument allows us to specify a dataset
that will train the imputation model. <code>data_train</code> can also
be a function that will applied to the original data set undergoing
imputation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_imputation_trained</span> <span class="op">&lt;-</span> <span class="va">data_demo</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/impute_values_by_length.html">impute_values_by_length</a></span><span class="op">(</span></span>
<span>    var_y <span class="op">=</span> <span class="va">sim_intelligibility</span>,</span>
<span>    var_length <span class="op">=</span> <span class="va">tocs_level</span>,</span>
<span>    id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">child</span>, <span class="va">age_months</span>, <span class="va">length_longest</span><span class="op">)</span>, </span>
<span>    include_max_length <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="co"># suppose we wanted to impute using older participants</span></span>
<span>    data_train <span class="op">=</span> <span class="va">data_demo</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age_months</span> <span class="op">&gt;</span> <span class="fl">44</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">data_imputation_trained_2</span> <span class="op">&lt;-</span> <span class="va">data_demo</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/impute_values_by_length.html">impute_values_by_length</a></span><span class="op">(</span></span>
<span>    var_y <span class="op">=</span> <span class="va">sim_intelligibility</span>,</span>
<span>    var_length <span class="op">=</span> <span class="va">tocs_level</span>,</span>
<span>    id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">child</span>, <span class="va">age_months</span>, <span class="va">length_longest</span><span class="op">)</span>, </span>
<span>    include_max_length <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="co"># suppose we wanted to impute using older participants</span></span>
<span>    data_train <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age_months</span> <span class="op">&gt;</span> <span class="fl">44</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">data_imputation_trained</span><span class="op">$</span><span class="va">sim_intelligibility_imputed</span>, </span>
<span>  <span class="va">data_imputation_trained_2</span><span class="op">$</span><span class="va">sim_intelligibility_imputed</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="utterance-weighting">Utterance weighting<a class="anchor" aria-label="anchor" href="#utterance-weighting"></a>
</h2>
<p>Below is the most recent non-package version of the utterance length
weighting code. The basic steps are</p>
<ul>
<li>preparing a dataset</li>
<li>fitting an ordinal regression model on the length of longest
utterance using age as a predictor</li>
<li>computing the probabilities for each utterance length as a function
of age</li>
</ul>
<p>Originally, we had used <code><a href="https://rdrr.io/pkg/MASS/man/polr.html" class="external-link">MASS::polr()</a></code> for the models but
I think <code><a href="https://rdrr.io/pkg/ordinal/man/clm.html" class="external-link">ordinal::clm()</a></code> is easier to use.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepare_longest_length_model_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">child</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      length_longest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">tocs_level</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">child</span>, <span class="va">tocs_level</span>, <span class="va">age_months</span>, <span class="va">length_longest</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tocs_level</span> <span class="op">==</span> <span class="va">length_longest</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      lol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">length_longest</span><span class="op">)</span>,</span>
<span>      lol_ord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">lol</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fit_longest_length_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">df</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">ordinal</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ordinal/man/clm.html" class="external-link">clm</a></span><span class="op">(</span></span>
<span>    <span class="va">lol_ord</span> <span class="op">~</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">age_months</span>, df <span class="op">=</span> <span class="va">df</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">data</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">compute_longest_length_weights</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">d_ages</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">age_months</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      <span class="co"># predicted longest length by age</span></span>
<span>      lol_predicted <span class="op">=</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Extract.html" class="external-link">getElement</a></span><span class="op">(</span><span class="st">"fit"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="va">d_ages</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, newdata <span class="op">=</span> <span class="va">_</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extract.html" class="external-link">getElement</a></span><span class="op">(</span><span class="st">"fit"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">d_ages</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">age_months</span>, <span class="va">lol_predicted</span><span class="op">)</span>,</span>
<span>      names_to <span class="op">=</span> <span class="st">"lol"</span>,</span>
<span>      values_to <span class="op">=</span> <span class="st">"lol_prob"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age_months</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      lol_num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">lol</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      lol_weighted <span class="op">=</span> <span class="va">lol_prob</span> <span class="op">*</span> <span class="va">lol_num</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">lol_num</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      prob_reach_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">lol_prob</span><span class="op">)</span>,</span>
<span>      normalized_prob_reach_length <span class="op">=</span> <span class="va">prob_reach_length</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">prob_reach_length</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Here we can apply this non-package implementation to the example
data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_lol</span> <span class="op">&lt;-</span> <span class="va">data_demo</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tocs_level</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">prepare_longest_length_model_data</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">fit_longest_length_model</span><span class="op">(</span><span class="va">data_lol</span>, df <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_lol_weights</span> <span class="op">&lt;-</span> <span class="va">data_lol</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">compute_longest_length_weights</span><span class="op">(</span>model <span class="op">=</span> <span class="va">m</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span></span>
<span>    <span class="va">age_months</span>, </span>
<span>    tocs_level <span class="op">=</span> <span class="va">lol_num</span>, </span>
<span>    <span class="va">prob_reach_length</span>, </span>
<span>    <span class="va">normalized_prob_reach_length</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>And here is how we can recreate the Figure from the supplemental
materials:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_lol_weights</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_months</span>, y <span class="op">=</span> <span class="va">prob_reach_length</span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">tocs_level</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">tocs_level</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">tocs_level</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="fl">29</span>,</span>
<span>    data <span class="op">=</span> <span class="va">data_lol_weights</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age_months</span> <span class="op">==</span> <span class="fl">30</span>, <span class="va">tocs_level</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    fontface <span class="op">=</span> <span class="st">"bold"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">tocs_level</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">tocs_level</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="fl">48</span>,</span>
<span>    data <span class="op">=</span> <span class="va">data_lol_weights</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age_months</span> <span class="op">==</span> <span class="fl">47</span>, <span class="va">tocs_level</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    fontface <span class="op">=</span> <span class="st">"bold"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_ordinal</a></span><span class="op">(</span>end <span class="op">=</span> <span class="fl">.85</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age [months]"</span>, y <span class="op">=</span> <span class="st">"Prob. of reaching length"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">49</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p1</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">normalized_prob_reach_length</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Weight of utterance length"</span><span class="op">)</span></span>
<span><span class="va">p2</span></span></code></pre></div>
<p><img src="utterance-length-imputation_files/figure-html/unnamed-chunk-13-1.png" width="40%"><img src="utterance-length-imputation_files/figure-html/unnamed-chunk-13-2.png" width="40%"></p>
<p>This implementation is somewhat unsatisfactory. It hardcodes variable
names, so it’s harder to reuse, and it is complicated to use, requiring
three functions and a join. In the package implementation, we hide
everything behind a single function.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weight_lengths_with_ordinal_model.html">weight_lengths_with_ordinal_model</a></span><span class="op">(</span></span>
<span>  data_train <span class="op">=</span> <span class="va">data_demo</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tocs_level</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>  var_length <span class="op">=</span> <span class="va">tocs_level</span>,</span>
<span>  var_x <span class="op">=</span> <span class="va">age_months</span>, </span>
<span>  id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">child</span><span class="op">)</span>, </span>
<span>  spline_df <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can see a match in weights between the two implementations.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">data_lol_weights</span><span class="op">$</span><span class="va">normalized_prob_reach_length</span>, </span>
<span>  <span class="va">data_plot</span><span class="op">$</span><span class="va">tocs_level_weight</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">data_lol_weights</span><span class="op">$</span><span class="va">prob_reach_length</span>, </span>
<span>  <span class="va">data_plot</span><span class="op">$</span><span class="va">tocs_level_prob_reached</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="combining-the-imputation-and-the-weights">Combining the imputation and the weights<a class="anchor" aria-label="anchor" href="#combining-the-imputation-and-the-weights"></a>
</h2>
<p>The last step of the process is to combine the imputed values and the
length weights, and then take the means of the imputed values. This step
is a straightforward table join. Although we used single-word scores for
imputation (because they are highly correlated with other
intelligibility scores), we do not use them for weighting. The target
variable here is a single-number summary of intelligibility in 2–7-word
utterances, so we exclude 1-word scores.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_weighted_1</span> <span class="op">&lt;-</span> <span class="va">data_imputation_1</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tocs_level</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">data_lol_weights</span>, by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">age_months</span>, <span class="va">tocs_level</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">data_means_wide_1</span> <span class="op">&lt;-</span> <span class="va">data_weighted_1</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">subject_num</span>, <span class="va">age_months</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    observed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sim_intelligibility</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    imputed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">imputed_sim_intelligibility</span><span class="op">)</span>,</span>
<span>    weighted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span></span>
<span>      <span class="va">imputed_sim_intelligibility</span>, </span>
<span>      <span class="va">normalized_prob_reach_length</span></span>
<span>    <span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="va">data_means_wide_1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 164 × 5</span></span></span>
<span><span class="co">#&gt;    subject_num age_months observed imputed weighted</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> c001                45    0.533   0.530    0.531</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> c002                42    0.389   0.337    0.360</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> c003                41    0.544   0.532    0.540</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> c004                42    0.660   0.660    0.655</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> c005                43    0.707   0.725    0.710</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> c006                42    0.524   0.513    0.523</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> c007                32    0.355   0.307    0.350</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> c008                43    0.828   0.828    0.832</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> c009                38    0.868   0.873    0.869</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> c010                47    0.767   0.767    0.765</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 154 more rows</span></span></span></code></pre></div>
<p>We can automate the joining step. Our
<code><a href="../reference/weight_lengths_with_ordinal_model.html">weight_lengths_with_ordinal_model()</a></code> takes an optional
<code>data_join</code> argument specifying a dataframe that the
estimated weights should be joined onto. This argument is intended for
the dataframe of imputed values. We cannot pass in the imputed values as
<code>data_train</code> because with missing values imputed, everyone
has the same length of longest utterance.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_weighted_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weight_lengths_with_ordinal_model.html">weight_lengths_with_ordinal_model</a></span><span class="op">(</span></span>
<span>  data_train <span class="op">=</span> <span class="va">data_demo</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tocs_level</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>  var_length <span class="op">=</span> <span class="va">tocs_level</span>,</span>
<span>  var_x <span class="op">=</span> <span class="va">age_months</span>, </span>
<span>  id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">child</span><span class="op">)</span>, </span>
<span>  spline_df <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  data_join <span class="op">=</span> <span class="va">data_imputation_2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tocs_level</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_means_wide_2</span> <span class="op">&lt;-</span> <span class="va">data_weighted_2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">child</span>, <span class="va">age_months</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    observed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sim_intelligibility</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    imputed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sim_intelligibility_imputed</span><span class="op">)</span>,</span>
<span>    weighted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">sim_intelligibility_imputed</span>, <span class="va">tocs_level_weight</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We can see the same results from both methods.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">data_means_wide_1</span><span class="op">$</span><span class="va">observed</span>, <span class="va">data_means_wide_2</span><span class="op">$</span><span class="va">observed</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">data_means_wide_1</span><span class="op">$</span><span class="va">imputed</span>,  <span class="va">data_means_wide_2</span><span class="op">$</span><span class="va">imputed</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">data_means_wide_1</span><span class="op">$</span><span class="va">weighted</span>, <span class="va">data_means_wide_2</span><span class="op">$</span><span class="va">weighted</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The three values overall are very similar:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_means</span> <span class="op">&lt;-</span> <span class="va">data_means_wide_2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">child</span>, <span class="op">-</span><span class="va">age_months</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"score"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"intelligibility"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_means</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_months</span>, y <span class="op">=</span> <span class="va">intelligibility</span>, color <span class="op">=</span> <span class="va">score</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="utterance-length-imputation_files/figure-html/unnamed-chunk-19-1.png" width="1093.75"></p>
<p>But importantly, imputation is negatively biased in younger children
who cannot reach the longer utterance lengths. Points fall below the
diagonal when the two types of scores are compared, and the difference
between the two scores is more negative at younger ages.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_means_wide_2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed</span>, y <span class="op">=</span> <span class="va">imputed</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="utterance-length-imputation_files/figure-html/unnamed-chunk-20-1.png" width="1093.75"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_means_wide_2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_months</span>, y <span class="op">=</span> <span class="va">imputed</span> <span class="op">-</span> <span class="va">observed</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linewidth <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="utterance-length-imputation_files/figure-html/unnamed-chunk-20-2.png" width="1093.75"></p>
<p>When we weight by utterance length probability, then the score has a
tighter correlation with observed, un-adjusted scores. The pointwise
differences between the weighted and observed values is small, between
±2 percentage points of intelligibility.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_means_wide_2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed</span>, y <span class="op">=</span> <span class="va">weighted</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="utterance-length-imputation_files/figure-html/unnamed-chunk-21-1.png" width="1093.75"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_means_wide_2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_months</span>, y <span class="op">=</span> <span class="va">weighted</span> <span class="op">-</span> <span class="va">observed</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linewidth <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="utterance-length-imputation_files/figure-html/unnamed-chunk-21-2.png" width="1093.75"></p>
<div class="section level3">
<h3 id="using-a-function-for-data_train">Using a function for <code>data_train</code><a class="anchor" aria-label="anchor" href="#using-a-function-for-data_train"></a>
</h3>
<p><code><a href="../reference/weight_lengths_with_ordinal_model.html">weight_lengths_with_ordinal_model()</a></code> also supports
providing a function for <code>data_train</code>. In this case, the
function is applied to <code>data_join</code>. Here is how we would
train the weights on the observed values in the imputation
dataframe.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_weighted_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weight_lengths_with_ordinal_model.html">weight_lengths_with_ordinal_model</a></span><span class="op">(</span></span>
<span>  data_train <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sim_intelligibility_imputation</span> <span class="op">==</span> <span class="st">"observed"</span><span class="op">)</span>, </span>
<span>  var_length <span class="op">=</span> <span class="va">tocs_level</span>,</span>
<span>  var_x <span class="op">=</span> <span class="va">age_months</span>, </span>
<span>  id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">child</span><span class="op">)</span>, </span>
<span>  spline_df <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  data_join <span class="op">=</span> <span class="va">data_imputation_2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tocs_level</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">data_weighted_2</span><span class="op">$</span><span class="va">tocs_level_prob_reached</span>, </span>
<span>  <span class="va">data_weighted_3</span><span class="op">$</span><span class="va">tocs_level_prob_reached</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Hustad, K. C., Mahr, T., Natzke, P. E. M., &amp; Rathouz, P. J.
(2020). Development of Speech Intelligibility Between 30 and 47 Months
in Typically Developing Children: A Cross-Sectional Study of Growth.
<em>Journal of Speech, Language, and Hearing Research</em>,
<em>63</em>(6), 1675–1687. <a href="https://doi.org/10.1044/2020_JSLHR-20-00008" class="external-link uri">https://doi.org/10.1044/2020_JSLHR-20-00008</a></p>
<p>Hustad, K. C., Mahr, T., Natzke, P. E. M., &amp; J. Rathouz, P.
(2020). Supplemental Material S1 (Hustad et al., 2020). ASHA journals.
<a href="https://doi.org/10.23641/asha.12330956.v1" class="external-link uri">https://doi.org/10.23641/asha.12330956.v1</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tristan Mahr.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
